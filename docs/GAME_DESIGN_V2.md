# ib-lol talk — Game Design V2 (LLM 중심 재구성)

## 핵심 철학
**의도 싸움(읽기/reads)이 게임의 본질이다.**
정확한 수치 시뮬레이션이 아니라, 플레이어와 AI의 **의도 충돌**에서 재미가 나온다.
교육 목적: 플레이어가 리신의 스킬과 롤의 라인전 메커니즘을 **체험으로** 배운다.

---

## 1. 아키텍처: LLM = 게임의 두뇌

### 이전 (V1)
```
플레이어 입력 → LLM(의도 해석) → 서버(수치 계산) → 결과
```
- 문제: LLM과 서버가 따로 놀아서 불일치 빈발. 수치 정확도는 게임성에 기여 안 함.

### 현재 (V2)
```
플레이어 입력 → LLM(의도 해석 + 결과 판정 + 상태 업데이트) → 서버(가드레일 검증) → 결과
```
- LLM이 **판정, 서술, 상태 업데이트**를 모두 담당
- 서버는 가드레일만: HP 범위(0~100%), 쿨타임 음수 방지, 필수 필드 존재 확인

---

## 2. 게임 상태 (단순화)

### HP: 퍼센트 기반
- 양쪽 HP 100%로 시작
- LLM이 교전 결과에 따라 % 단위로 깎음
- 가이드라인 (프롬프트에 포함):

| 행동 | 예상 피해 |
|------|----------|
| AA 1대 | 3~5% |
| Q1 적중 | 5~8% |
| Q1→Q2 콤보 | 10~15% |
| E1 | 6~9% |
| 풀콤보 (Q1→Q2→E1→AA→AA) | 20~30% |
| R (궁극기) | 12~18% |
| 점화 (Ignite) | 8~12% (DoT) |

※ 레벨, 아이템, 스킬 랭크에 따라 LLM이 조정. 이 표는 참고 범위.

### 에너지
- 200으로 시작, 스킬당 50 소모, 턴마다 일부 회복
- LLM이 관리 (사용/회복 판정)

### 쿨타임
- 스킬별 쿨타임 (턴 수). LLM이 사용 시 설정, 매 턴 감소
- 스킬 미습득(레벨 0) = 사용 불가

### 위치: 상황 태그
그리드 좌표(x,y) 제거. 대신 **상황 기반 위치**:
- `MELEE_RANGE` — 근접 (AA, E, R 사거리)
- `MID_RANGE` — 중거리 (Q 사거리 내)
- `BEHIND_MINIONS` — 미니언 뒤 (Q 차단됨)
- `BUSH` — 부쉬 (시야 차단)
- `TOWER_RANGE` — 타워 사거리 내
- `FAR` — 멀리 (스킬 사거리 밖)
- `RETREATING` — 후퇴 중

### CS / 골드 / 레벨
- CS: LLM이 턴마다 파밍 결과 판정 (0~4개)
- 골드: CS당 약 18골드
- 레벨: 일정 CS/턴 수 도달 시 레벨업. LLM이 판단.
- 킬 시 골드/경험치 보너스

---

## 3. 턴 시스템: 의도 단위

### 턴 = 하나의 "의도"
플레이어가 자연어로 의도를 표현하면 그게 1턴:
- "Q로 찔러보고 맞으면 따라간다" → Q1 적중 여부 판정 → 맞으면 Q2까지 → 1턴
- "미니언 뒤에서 안전하게 CS 먹기" → 파밍 결과 + AI 반응 → 1턴
- "부쉬 숨어서 기습 노리기" → 대기 + AI가 어떻게 대응하는지 → 1턴
- "E 범위 들어가서 압박" → 전진 + 교전 발생 여부 → 1턴

### 콤보는 1턴, 서술에서 풀어 설명
잘못된 예: "풀콤 35% 피해"
올바른 예:
> "Q1 음파를 날렸다 — 적중! 표식이 남았다. 바로 Q2로 돌진해 적에게 붙는다. 
> 착지하자마자 E1 폭풍으로 주변을 쓸고, 패시브를 살려 AA 두 방을 넣는다.
> 총 ~25% 피해. 에너지가 많이 소모됐다."

각 스킬이 **뭘 하는지** 자연스럽게 드러나야 함 (교육 목적).

### AI도 의도 기반 행동
AI는 플레이어 의도를 **읽고 대응**:
- 플레이어 Q → AI가 미니언 뒤로 이동 (Q 차단) → "실전에서도 Q는 미니언 뒤에서 피함"
- 플레이어 CS → AI가 그 타이밍에 트레이드 → "막타 순간이 가장 취약한 타이밍임"
- 플레이어 부쉬 → AI가 웨이브 푸시 → "부쉬 견제는 웨이브 컨트롤로 대응함"
- 플레이어 올인 → AI가 W 쉴드 + 반격 콤보 → "올인 들어오면 W로 버티고 카운터함"

AI의 **대응 이유**가 교육 콘텐츠.

---

## 4. 스킬 시스템

### 리신 스킬 (양쪽 동일)
- **Q (음파/공명타)**: Q1 직선 투사체(미니언 차단됨) → 적중 시 Q2 돌진 가능
- **W (방호/철갑)**: W1 아군/미니언에게 돌진 + 쉴드 → W2 생명력흡수
- **E (폭풍/쇠약)**: E1 주변 원형 피해 → E2 둔화
- **R (용의 분노)**: 대상 넉백 (타워 쪽으로 차면 킬각!)
- **패시브 (연타)**: 스킬 사용 후 AA 2회 공속 증가 + 에너지 회복

### 스킬 레벨업: 채팅 내 처리
레벨업 시 오버레이 대신 채팅으로:
> 🎉 레벨 2 달성! 어떤 스킬을 배울래?
> • Q (음파) — 원거리 투사체, 맞으면 돌진
> • W (방호) — 쉴드 + 이동기
> • E (폭풍) — 근접 범위 피해 + 둔화

플레이어가 "Q" 또는 "음파 배울래" 입력 → 반영.
R은 레벨 6에서 자동 해금 안내.

---

## 5. 소환사 주문 & 룬

### 소환사 주문 (게임 시작 시 선택)
- **점멸 (Flash)**: 고정. 즉시 이동, 위기 탈출/기습. 긴 쿨타임.
- **점화 (Ignite)**: 지속 피해 + 치유 감소. 킬각에 사용.
- **탈진 (Exhaust)**: 상대 둔화 + 피해 감소. 올인 방어.
- **방어막 (Barrier)**: 즉시 보호막. 생존용.
- **텔레포트 (TP)**: 귀환 후 빠른 복귀.

### 룬 (게임 시작 시 선택)
- **정복자 (Conqueror)**: 장기 교전에 강함. 스택 쌓이면 AD 증가 + 회복
- **감전 (Electrocute)**: 짧은 교전에 강함. 3히트 시 추가 폭딜
- **착취의 손아귀 (Grasp)**: 지속 체력전. 주기적 AA에 추가 피해 + 회복 + 영구 체력

룬은 교전 스타일을 결정하는 핵심 전략 요소. LLM이 룬 효과를 교전 판정에 자연스럽게 반영.

---

## 6. 승리 조건
1. **킬** — 상대 HP 0%
2. **CS 100** — 먼저 CS 100 도달
3. **타워 파괴** — 상대 타워 체력 0

---

## 7. LLM 응답 형식

```json
{
  "narrative": "교전/상황 서술 (스킬 하나하나 설명, 교육적)",
  "aiChat": "AI의 반응 (~함 체). 대응 이유 + 팁 포함",
  "stateUpdate": {
    "playerHp": 75,
    "enemyHp": 82,
    "playerEnergy": 100,
    "enemyEnergy": 150,
    "playerCooldowns": { "Q": 3, "W": 0, "E": 0, "R": 0 },
    "enemyCooldowns": { "Q": 0, "W": 4, "E": 0, "R": 0 },
    "playerPosition": "MID_RANGE",
    "enemyPosition": "BEHIND_MINIONS",
    "playerCs": 12,
    "enemyCs": 14,
    "playerLevel": 2,
    "enemyLevel": 2,
    "playerGold": 216,
    "enemyGold": 252
  },
  "levelUp": null,
  "suggestions": [
    "Q로 미니언 사이 빈틈 노려서 견제",
    "W 쉴드 깔고 앞으로 걸어가서 AA 트레이드",
    "안전하게 뒤에서 CS만 챙기기"
  ],
  "gameOver": null
}
```

### `levelUp` (레벨업 시)
```json
{
  "levelUp": {
    "newLevel": 3,
    "options": ["Q", "W", "E"],
    "descriptions": ["음파 강화 — 피해 증가", "방호 강화 — 쉴드 증가", "폭풍 강화 — 피해 + 둔화 증가"]
  }
}
```

### `gameOver` (게임 종료 시)
```json
{
  "gameOver": {
    "winner": "player",
    "reason": "kill",
    "summary": "게임 요약 + 잘한 점/개선점"
  }
}
```

---

## 8. 서버 역할 (가드레일)

서버가 하는 일:
1. LLM API 호출
2. JSON 파싱 + 필수 필드 확인
3. **범위 검증**:
   - HP: 0~100 (0 미만 → 0, 100 초과 → 100)
   - 에너지: 0~200
   - 쿨타임: 0 이상
   - CS: 이전보다 감소 불가
   - 레벨: 이전보다 감소 불가
4. 검증된 상태를 클라이언트에 반환

서버가 **하지 않는** 일:
- 데미지 계산
- 적중/회피 판정
- 위치 계산
- 콤보 처리

---

## 9. 프론트엔드

### UI 구조 (유지)
- KakaoTalk 스타일 채팅 (노란 말풍선 = 나, 흰 말풍선 = AI/내레이터)
- 상단 상태바 (HP%, 에너지, CS, 레벨, 쿨타임)
- 하단 텍스트 입력 + 추천 선택지 칩
- 셋업 화면 (스펠/룬 선택)

### 변경점
- 스킬업 오버레이 제거 → 채팅 내 처리
- 상태바에서 정확한 HP 숫자 대신 % 표시
- 위치 정보: 텍스트 태그로 표시 (근접/원거리/부쉬 등)

---

## 10. 기술 스택

- **프론트엔드**: 바닐라 HTML/CSS/JS (유지)
- **서버**: Vercel Serverless Functions (유지)
- **LLM**: Claude (Anthropic API)
- **상태 관리**: Stateless (클라이언트가 전체 상태 보유, 서버에 매 턴 전송)

---

## 11. 피해 판정 (LLM 재량)

LLM이 **리신 스킬 특성 + 현재 상태**를 참고해서 피해를 직접 결정한다.
고정 수치표 없음. 아래 특성을 이해하고 상황에 맞게 판정.

### 스킬 피해 특성
- **AA**: 총AD 기반 물리 피해. 가장 약하지만 자원 소모 없음
- **Q1 (음파)**: 보너스AD 비례 물리 피해. 중거리 견제용
- **Q2 (공명타)**: 보너스AD 비례 물리 피해 + **상대 잃은 체력에 비례하여 최대 2배**. 상대 HP 낮을수록 강력
- **W1 (방호)**: 피해 없음. 쉴드 부여 (스킬 랭크에 비례)
- **E1 (폭풍)**: 총AD 비례 **마법** 피해. 근접 범위. 방어력 아닌 마법저항으로 경감
- **R (용의 분노)**: 보너스AD 비례 물리 피해. 강력 + 넉백 효과
- **패시브 (연타)**: 스킬 사용 후 AA 2회 공속 40%↑ + 에너지 회복. 콤보 사이에 AA 끼워넣으면 효율적

### 피해 판정 시 고려할 것
- **레벨 차이**: 레벨이 높으면 기본 스탯이 더 높아 피해/방어 모두 증가
- **스킬 랭크**: 높을수록 기본 피해 증가
- **Q2의 잃은 체력 비례**: 상대 HP 50% 이하면 Q2가 매우 강해짐
- **물리 vs 마법**: Q/AA/R은 물리(방어력 경감), E는 마법(마저 경감). 리신은 물리 방어가 높으므로 E가 의외로 잘 들어감
- **룬 효과**: 정복자(장기전 스택→AD+회복), 감전(3히트 추가 폭딜), 착취(AA 추가피해+회복+영구체력)
- **소환사 주문**: 점화(지속피해+치유감소), 탈진(피해 35% 감소), 방어막(보호막)
- **타워 아래 교전**: 타워가 공격자에게 지속 피해. 매우 위험
- **쉴드**: W 쉴드가 남아있으면 피해 흡수
