# ib-lol talk — Game Design Document

## 개요
리그 오브 레전드 라인전을 오마주한 웹 브라우저 기반 Interactive Fiction 게임.
텍스트 서술과 이미지로 라인전 1v1 대결을 진행한다.

## 핵심 규칙

### 플랫폼
- 웹 브라우저 (HTML/CSS/JS)

### 게임 모드
- 1v1 라인전
- 초기: AI 상대 (싱글플레이)
- 추후: 멀티플레이어 지원

### 입력 방식: 자연어 입력
- 플레이어가 자유 텍스트로 의도를 입력 (예: "CS 먹으면서 안전하게", "Q 찔러본다", "부쉬 잠입 후 올인")
- LLM이 입력을 해석하여 게임 규칙 내 행동으로 변환
- 확인 단계 없이 즉시 실행 — 속도감 유지
- 빠른 입력용 칩 버튼도 제공 (CS, Q, 후퇴, 압박, E, 부쉬)

### 턴 구조: 상황 단위 턴
- **시간 고정이 아니라 "의미 있는 상황 변화" 단위**로 턴을 끊음
- 양쪽 행동의 **조합**이 결과를 결정 (확률 없음, 순수 전략)

#### 턴 규모 — 행동 강도에 따라 자동 조절
| 상황 | 턴 규모 | 예시 |
|------|---------|------|
| 양쪽 다 저강도 | 웨이브 단위 (~30초) | 파밍 vs 파밍 |
| 한쪽이라도 고강도 | 스킬 단위 (~2~3초) | 파밍 vs Q 찔러보기 |
| 양쪽 다 고강도 | 동시 교전 | 올인 vs 올인 |

- **저강도**: 파밍, 대기, 이동, 후퇴
- **고강도**: 스킬 사용, 올인, 기습, 소환사 주문

#### 끼어들기 (Interrupt) 시스템
큰 단위 행동(저강도) 도중 상대가 고강도 행동을 하면 **끼어들기** 발생:

1. 플레이어가 "CS 먹으면서 안전하게" 입력 (저강도, 웨이브 단위)
2. AI가 "Q 찔러보기" 결정 (고강도)
3. LLM이 끼어들기 연출: "캐스터 미니언을 정리하려는 순간, 상대가 음파를 날렸다!"
4. **턴이 즉시 끊김** → 다음 턴에 플레이어가 대응 기회를 얻음

**핵심 트레이드오프**: 큰 단위 입력 = 편하지만 빈틈 노출 / 세밀한 입력 = 안전하지만 매 턴 판단 필요

#### 끼어들기 규칙
- 저강도 vs 저강도 → 끼어들기 없음, 한 턴에 처리
- 저강도 vs 고강도 → 끼어들기 발생, 고강도 행동까지만 처리 후 턴 종료
- 고강도 vs 고강도 → 동시 교전, 거리/선딜로 우선순위 판정

### 승리 조건 (먼저 달성한 쪽 승리)
1. **킬** — 상대 HP를 0으로 만듦
2. **CS 100** — 미니언 100마리 먼저 처치
3. **타워 파괴** — 상대 타워 체력을 0으로 만듦

### 제약
- 정글러 없음 (순수 1v1)
- 귀환 1회 가능 (아이템 구매)

---

## 맵 / 그리드 시스템

### 그리드 기본 사양
- **단위**: 50 LoL 유닛 = 1칸
- **크기**: 가로 60칸 × 세로 24칸 (3000 × 1200 LoL 유닛)
- **그리드는 플레이어에게 보이지 않음** — 내부 엔진 전용
- 모든 유닛(챔피언, 미니언, 타워)은 그리드 위 (x, y) 좌표를 가짐

### 레인 구조 (그리드 좌표)

```
Y
0  ┌──────────────────────────────────────────────────────────┐
   │                     윗 부쉬 영역                          │
4  │  ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░  │
6  ├──────────────────────────────────────────────────────────┤
   │                                                          │
   │  [아군타워]              레인 도로              [적타워]   │
   │   (3,12)                                       (57,12)   │
   │                                                          │
18 ├──────────────────────────────────────────────────────────┤
20 │  ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░  │
   │                     아래 부쉬 영역                        │
24 └──────────────────────────────────────────────────────────┘
   0         10        20        30        40        50     60  X
```

### 주요 좌표
| 오브젝트 | X | Y | 비고 |
|---------|---|---|------|
| 아군 타워 | 3 | 12 | 레인 중앙선 |
| 적 타워 | 57 | 12 | 레인 중앙선 |
| 미니언 충돌 지점 | 30 | 12 | 레인 정중앙 |
| 윗 부쉬 | 18~42 | 2~5 | 가로로 긴 영역 |
| 아래 부쉬 | 18~42 | 19~22 | 가로로 긴 영역 |

### 레인 영역 (Y축 기준)
| Y 범위 | 영역 |
|--------|------|
| 0~5 | 윗 부쉬 + 강가 |
| 6~18 | 레인 도로 (이동 가능 주 영역) |
| 19~24 | 아래 부쉬 + 강가 |

### 이동 속도 (그리드 환산)
- 1턴 = 3초
- 이속 345 = 턴당 1035 유닛 = **약 20칸**
- 둔화 시 이동량 감소 (예: 35% 둔화 → 13칸)

### 사거리 (그리드 환산)
| 사거리 | LoL 유닛 | 그리드 칸 |
|--------|---------|----------|
| 기본공격 (근접) | 125 | 2~3칸 |
| E1 (폭풍) 범위 | 450 | 9칸 |
| W1 (방호) 사거리 | 700 | 14칸 |
| Q1 (음파) 사거리 | 1200 | 24칸 |
| R (용의 분노) 사거리 | 375 | 7~8칸 |
| 타워 사거리 | 750 | 15칸 |

---

## 그리드의 역할

### 그리드가 결정하는 것
- 스킬/AA 사용 가능 여부 (사거리 안에 있는가?)
- 미니언 뒤에 숨기 판정 (Q는 미니언에 먼저 맞음)
- 부쉬 안/밖 판정
- 타워 사거리 판정
- 캔버스 렌더링 위치
- 의도 선택지 필터링 (현재 위치에서 가능한 의도만 표시)

### 그리드가 결정하지 않는 것
- 스킬 적중/회피 → **의도 조합표**가 결정 (확률 0)
- 이동 방향/거리 → **의도**가 결정, 엔진이 좌표 반영

---

## 의도 기반 선택 시스템

### 핵심 개념
플레이어는 그리드 좌표를 직접 조작하지 않는다.
**"무엇을 하고 싶은가"** (의도)를 선택하면, 엔진이 그리드 위 좌표를 계산한다.

### 포지셔닝 의도

| 의도 ID | 한국어 | 설명 | 엔진 동작 |
|---------|--------|------|-----------|
| PRESS | 압박 진입 | 적 스킬 사거리 안으로 전진 | 적과의 거리를 좁힘 (상대 Q 사거리 경계 안쪽) |
| HARASS_POS | 견제 위치 | 스킬 쏠 수 있는 거리 유지 | 내 Q 사거리 끝에서 유지 |
| CS_SAFE | 미니언 뒤 CS | 미니언 뒤에서 막타 | 미니언 뒤쪽에 위치, 제자리 |
| CS_PUSH | 미니언 밀기 | 미니언에 스킬+AA | 미니언 근처, 제자리 |
| RETREAT | 후퇴 | 타워 쪽으로 빠짐 | 아군 타워 방향으로 이동 |
| BUSH_IN | 부쉬 진입 | 가까운 부쉬로 이동 | 가까운 부쉬 좌표로 이동 |
| BUSH_OUT | 부쉬 탈출 | 부쉬에서 레인으로 복귀 | 레인 도로로 이동 |
| ALL_IN | 올인 | 적에게 돌진 | 적 근접 사거리까지 접근 |

### 공격 의도 (포지셔닝과 결합)

| 의도 ID | 한국어 | 조건 |
|---------|--------|------|
| Q1_CAST | Q 발사 | 기력 50+, Q 쿨 가능, 적 Q 사거리 내 |
| Q2_CAST | Q 돌진 | Q1 적중 상태 |
| W1_SELF | W 셀프 쉴드 | 기력 50+, W 쿨 가능 |
| W1_MINION | W 미니언 돌진 | W 쿨 가능, 근처 미니언 존재 |
| W2_CAST | W 생흡 | W1 사용 후 |
| E1_CAST | E 사용 | 기력 50+, E 쿨 가능, 적 E 사거리 내 |
| E2_CAST | E 둔화 | E1 적중 후 |
| R_CAST | R 사용 | R 쿨 가능, 적 R 사거리 내 |
| AA_CHAMP | 기본공격 | 적 AA 사거리 내 |

### 선택지 생성 규칙
엔진이 현재 그리드 상태를 보고 가능한 의도만 표시:
1. **사거리 체크** — 현재 위치에서 사거리 안에 있는 스킬만 공격 선택지에 표시
2. **미니언 체크** — 막타 가능한 미니언이 있을 때만 CS 선택지 표시
3. **부쉬 체크** — 부쉬 근처일 때만 부쉬 진입 표시
4. **쿨타임/기력 체크** — 사용 가능한 스킬만 표시

---

## 조합표: 의도 조합 판정

### 원칙
- 양쪽의 **의도 조합**으로 결과가 결정됨
- 확률 0 — 순수 전략
- 의도에 "미니언 뒤에 있다", "압박 위치에 있다" 같은 위치 정보가 내포됨

### 스킬샷 (Q) 적중 판정

Q는 직선 투사체. 적중 여부는 **적의 의도**에 따라 결정:

| 내 행동 | 적 의도 | 결과 | 이유 |
|---------|---------|------|------|
| Q1 | CS_SAFE (미니언 뒤) | ❌ 미니언에 막힘 | 미니언이 투사체 차단 |
| Q1 | CS_PUSH (미니언 근처) | ❌ 미니언에 막힘 | 미니언 사이에 있음 |
| Q1 | PRESS (압박 진입) | ✅ 적중 | 앞으로 걸어나옴, 미니언 앞에 노출 |
| Q1 | HARASS_POS (견제) | ⚠️ 조건부 | 미니언 라인 밖이면 적중, 뒤면 차단 |
| Q1 | RETREAT (후퇴) | ❌ 빗나감 | 뒤로 빠져서 사거리 밖 가능 |
| Q1 | BUSH_IN (부쉬) | ❌ 빗나감 | 시야 상실 + 위치 이탈 |
| Q1 | ALL_IN (올인) | ✅ 적중 | 달려오는 중 |
| Q1 | AA_CHAMP (기본공격) | ✅ 적중 | 근접 사거리에서 서있음 |
| Q1 | MV_DODGE (회피 기동) | ❌ 빗나감 | 옆으로 빠짐 |

### 범위기 (E) 적중 판정

E는 자기 주변 원형 범위 (9칸). 범위 안에 있으면 맞음:

| 내 행동 | 적 의도 | 결과 | 이유 |
|---------|---------|------|------|
| E1 | 인접 거리에서 CS/AA/PRESS | ✅ 적중 | 범위 안 |
| E1 | RETREAT | ⚠️ 조건부 | 거리에 따라 범위 밖 탈출 가능 |
| E1 | BUSH_IN | ❌ 회피 | 범위 밖으로 이탈 |
| E1 | FLASH | ❌ 회피 | 즉시 범위 밖 |
| E1 | ALL_IN (밖에서) | ✅ 적중 | 달려와서 범위 안 진입 |

### 대상지정 (AA, R, 점화) 적중 판정

대상지정은 사거리 안이면 기본 적중. 제한된 회피만 가능:

| 내 행동 | 적 의도 | 결과 |
|---------|---------|------|
| AA/R | 사거리 내 어떤 행동 | ✅ 적중 |
| AA/R | RETREAT (사거리 밖으로) | ❌ 회피 |
| AA/R | BUSH_IN | ❌ 시야 상실 |
| AA/R | FLASH | ❌ 점멸 회피 |
| AA/R | W1_MINION (미니언 돌진) | ❌ 사거리 밖 이탈 |

### 맞교환 규칙
양쪽 다 공격 선택 시:
- **둘 다 적중 조건을 만족하면 둘 다 맞음** (맞교환)
- 공격하면서 동시에 회피할 수 없음 (공격 = 위치 고정)
- Q를 쏘면서 상대 Q를 피할 수 없음

### CS와 포지셔닝 트레이드오프
- CS를 먹으려면 미니언 근처에 서야 함 → 위치 예측 가능
- CS_SAFE는 미니언 뒤 → Q에 안전하지만 소극적
- 회피 기동(MV_DODGE) → CS 놓침
- → **CS를 먹을 것인가 vs 회피할 것인가**가 핵심 긴장감

---

## 챔피언

### 초기 지원: 리신 (Lee Sin)
추후 챔피언 추가 예정.

#### 기본 스탯 (레벨 1, 실제 롤 수치)
- HP: 645
- 기력(Energy): 200
- AD: 69
- 방어력: 36
- 마법저항력: 32
- 이동속도: 345
- 공격 사거리: 125 (근접)

#### 스킬
- **패시브 (연타)**: 스킬 사용 후 2회 기본공격 공속 40% 증가, 기력 회복
- **Q (음파/공명타)**: 음파 발사 → 적중 시 재사용으로 돌진. 물리 피해.
- **W (방호/철갑)**: 자신/아군에게 돌진 + 쉴드. 재사용 시 생명력 흡수.
- **E (폭풍/쇠약)**: 주변 범위 마법 피해. 재사용 시 둔화.
- **R (용의 분노)**: 대상 넉백 + 물리 피해.

---

## 미니언 시스템
- 10턴마다 새 웨이브 도착 (근접 3 + 원거리 3)
- 미니언은 그리드 위에 좌표를 가짐 (레인 중앙에서 충돌)
- 미니언끼리 자동 교전 → HP 감소
- 플레이어가 막타를 쳐야 CS로 인정
- **미니언은 Q 투사체를 차단** (미니언 뒤에 숨기 핵심)

### 미니언 그리드 배치
- 아군 미니언: 충돌 지점(x=30) 왼쪽에 산개
- 적 미니언: 충돌 지점 오른쪽에 산개
- 미니언 간 y축 산개로 자연스러운 라인 형성

---

## 레벨 시스템
- 미니언 처치 및 근처 미니언 사망으로 경험치 획득
- 레벨업 시 스킬 포인트 배분 (스킬은 레벨 0부터 시작)
- 실제 롤 경험치 테이블 참고

---

## 아이템 시스템
- 귀환 1회 시 골드로 아이템 구매
- 시작 아이템: 도란의 검 + 체력 포션 1개
- 구매 가능 아이템: 추후 정의

---

## 소환사 주문
- 점멸 (Flash): 즉시 이동 (쿨 300초)
- 점화 (Ignite): 대상에게 지속 피해 (쿨 180초)
- 게임 시작 전 2개 선택

---

## 특수 상황

### RECALL (귀환)
- 귀환 중 **어떤 피해라도** 받으면 귀환 취소
- 아군 타워 아래에서만 귀환 가능
- 귀환 성공 시 아이템 구매 → 라인 복귀

### FLASH (점멸)
- 모든 공격 회피 가능
- 위치 대폭 이동 (약 10칸)
- E1 범위 안이라도 점멸로 탈출 가능

### IGNITE (점화)
- 인접 거리에서만 사용
- 5턴에 걸쳐 지속 피해
- 치유량 감소 효과

---

## 부쉬 규칙
1. 부쉬 안의 챔피언은 상대에게 **보이지 않음**
2. 부쉬에서 나오며 공격 → 기습 (상대가 대응 선택을 못 함?)
3. 양쪽 다 같은 부쉬 → 서로 보임
4. 부쉬에 있으면 CS 불가 (미니언과 거리가 있음)

---

## 상황 흐름 구조

```
[상황 서술] → [양쪽 선택] → [조합 결과 계산] → [결과 서술] → [상태 업데이트] → 반복
```

### 1상황 = 약 3초 (게임 내 시간)
- 쿨타임은 "상황 수"로 환산
- Q 쿨 10초 = 약 3~4상황
- 미니언 웨이브: 약 10상황마다 새 웨이브 도착

---

## AI 상대 설계 (초기)

### 난이도 = 성격 (확률 조절 아님)
AI 난이도는 "실수 확률"이 아니라 **성격적 약점**으로 표현한다.
플레이어가 AI의 성격을 읽고 약점을 이용해 이기는 구조.

| 난이도 | 성격 | 약점 |
|--------|------|------|
| **쉬움** | 혈기왕성 — 싸움을 좋아하고 킬각을 과대평가 | 쿨다운 관리 못함, CS 밀림, 무모한 올인 |
| **보통** | 밸런스형 — 적절히 파밍하고 기회를 노림 | 가끔 과한 트레이드, 부쉬 체크 소홀 |
| **어려움** | 냉정 계산형 — 킬각 없으면 CS 집중, 상대 실수만 기다림 | 거의 없음. 플레이어가 먼저 읽기를 해야 함 |

### AI 성격의 효과
- 성격이 **일관된 행동 패턴**을 만듦 → 플레이어가 읽을 수 있음
- "이 AI는 HP 60% 이하면 올인 들어온다" 같은 패턴이 형성
- 패턴을 읽었으면 역이용 가능 → **의도 싸움의 본질**

### AI 구현 (LLM 프롬프트)
- LLM 시스템 프롬프트에 AI 성격을 상세히 기술
- LLM이 성격에 맞게 행동을 결정 + 결과를 서술
- 서버가 수치 계산(데미지, 쿨다운 등)을 검증

---

## UI 구성 (웹)
- 캔버스: 그리드 기반 미니맵 (유닛 위치 시각화, 그리드선은 비표시)
- 상단: 양쪽 상태바 (HP, 기력, 레벨, CS) — 컴팩트
- 하단: 의도 선택 버튼 (자연어 한국어)
- 게임 로그: 접이식 패널 (턴별 양쪽 선택 + 결과)

---

## 기술 스택
- **프론트엔드**: HTML / CSS / JavaScript (바닐라), 카카오톡 스타일 채팅 UI
- **백엔드**: Node.js + Express (서버 사이드 게임 상태 관리)
- **LLM**: Anthropic Claude API (서버에서 호출) — 자연어 해석 + AI 행동 + 서술
- **하이브리드 구조**: LLM = 해석 + 서술, 서버 코드 = 수치 계산 + 규칙 검증
- 추후 멀티플레이어: WebSocket 서버
